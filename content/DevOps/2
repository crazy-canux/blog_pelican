Title: Make
Date: 2017-01-12 21:18:33
Tags: Make, Makefile



# Make

make的作用：
* 控制源代码的编译
* 手册页的编写
* 将应用程序安装到目标目录

make的使用规则：
* 如果工程没有编译过，需要编译所有源文件和链接所有目标文件．
* 如果工程里某几个目标文件被修改，只需要编译修改的源文件，并链接所有目标文件．
* 如果头文件被修改，只需要编译引用了被修改的头文件的源文件，并链接所有目标文件．

makefile文件查找顺序：
* 当前目录找makefile
* 当前目录找Makefile
* 当前目录找GNUmakefile

# make命令

make命令会执行当前目录的makefile/Makefile/GNUmakefile文件．

    make [options] [target] ...
    -f FILE, --file=FILE, --makefile=FILE    # 指定makefile文件
    -n, --just-print, --dry-run, --recon # 只打印，不执行
    -k, --keep-going　# 忽略错误继续执行

    make
    make all
    make install
    make clean

# makefile格式

make命令执行makefile文件时，会比较target和prerequisites的时间戳，如果后者比前者新，或者前者不存在，就会执行command,否则会跳过command.

其中#表示注释，\表示续行．@表示该命令的执行不会打印到stdout,-表示忽略错误继续执行．

    # comment
    target: prerequisites...
        command
        command to \
        long
        @command
        -command
        ...

makefile的变量：

    定义变量：
    obj=a.o b.o c.o
    使用变量：
    $(obj)

自动化变量：

    $<    # 第一个依赖文件
    $^    # 所有的依赖文件
    $@    # 目标文件
    $*    # 不包含扩展名的目标文件名称
    $+    # 所有的依赖文件，用空格分开
    $?    # 所有时间戳比目标文件晚的依赖文件，以空格分开
    $%    # 如果目标是归档成员，则表示目标的归档成员

清空目标文件：

    clean:
        -rm elf $(obj)
    # 或者用.PHONY表示clean是一个伪目标
    .PHONY: clean
    clean:
        -rm elf $(obj)

